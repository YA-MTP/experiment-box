====== Capture CameraV2 Raspebrry Pi ======

===== Paquets nécessaire =====

  * raspistill
  * jhead //(pour changer le nom de la capture par sa date)//


===== Scripts =====
==== Renommer l'image par sa date et heure ====
Script **catpure_raspi.sh**
<code>
#!/bin/bash
# Format date YYYY-MM-DD_hh-mm-ss

raspistill -r -o /home/pi/Pictures/capture_raspi/capture.jpg -a 8 -a "RaspiCam %Y-%m-%d %X"
jhead -n%Y-%m-%d_%H-%M-%S /home/pi/Pictures/capture_raspi/capture.jpg
</code>
Capture d'une image placée dans /home/pi/Pitcures/capture_raspi et nommée capture.jgp
Puis capture.jpg renommer en sa date sous le format AAAA-MM-DD_hh_mm_ss.jpg
> -o : nom du fichier
> -r (--raw) : ajout de données brutes
> -a (--annotate) : ajout d'annotation sur l'image
>

==== Renommer l'image par sa time-stamp ====
Script **rename_timestmap.sh** :
<code>
#!/bin/bash

fichier=$1
path=$(dirname $1)
path+="/"
timestamp=$(stat -c %Y $fichier)
timestamp+=".jpg"
dest=$path$timestamp

echo "$fichier renommer en $timestamp"
mv $fichier $dest
</code>
> **fichier=$1 :** On ajoute a une variable $fichier le fichier capture.jpg passé en attribut positionnel 
> **path=$(dirname $1) :** On ajoute a une variable $path le chemin de capture.jpg
> **path+="/" :** On ajoute un / a la fin du chemin
> **timestamp=$(stat -c %Y $fichier) :** On ajoute le time-stamp de capture.jpg dans un variable $timestamp
> **timestamp+=".jpg" :** On ajoute l'extension .jpg a la fin du timestamp
> **dest=$path$timestamp :** On additionne le chemin et le nouveau nom du fichier pour creer la variable $dest du dossier le destination
> **mv $fichier $dest :** On renomme capture.jpg par son timestamp

Puis script **catpure_raspi.sh** :
<code>
#!/bin/bash
raspistill -r -o /home/pi/Pictures/capture_raspi/capture.jpg -a 8 -a "RaspiCam %Y-%m-%d %X"
/home/pi/scripts/./rename_timestamp.sh capture.jpg
</code>


==== Crontab ====
<code>
0 12 * * * /home/pi/scripts/./capture_cam_raspi.sh
</code>
> Tout le jour à midi, le script se lancera


== Récupérer la capture par scp ==
Script **scp_captureraspi.sh** : FIXME
<code>
#!/bin/bash

fichier=$1
scp <user>@<ip_server>:/home/pi/Pictures/captures/$fichier /home/<user>/Documents/Cam\ V2\ Raspi/capture_raspi/
</code>

==== Page web ====
FIXME \\
Page web avec la dernière photo enregisté :

  * Modifier le script :
<code>
#!/bin/bash
raspistill -r -o /home/pi/Pictures/capture_raspi/capture.jpg -a 8 -a "RaspiCam %Y-%m-%d %X"
cp /home/pi/Pictures/capture_raspi/capture.jpg /var/www/html
/home/pi/scripts/./rename_timestamp.sh capture.jpg
</code>

  * index.html dans /var/www/html (avec apache2)
<code>
<!DOCTYPE html>
<html>
        <head>
                <meta charset="UTF-8" >
                <title>Capture RasPi</title>
                <link rel="stylesheet" href="style.css">
        </head>
        <body>
                <h1>Capture RasPi</h1>
                <img src="capture.jpg" alt"capture" style="width:1080px;height:720px;">
        </body>
</html>
</code>